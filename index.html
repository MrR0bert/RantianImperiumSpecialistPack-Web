<!DOCTYPE html>
<html lang="en" class="scroll-smooth" :class="{ 'dark': darkMode }" x-data="mainApp()" x-init="init()" x-cloak>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Specialist Request Form</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

  <style>
    [x-cloak] { display: none !important; }
  </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 flex flex-col min-h-screen">

  <!-- Navigation -->
  <nav class="bg-white dark:bg-gray-800 shadow p-4 flex justify-between items-center">
    <div class="flex space-x-6">
      <a href="index.html" class="font-semibold hover:underline" :class="{'underline': page === 'form'}" @click.prevent="navigate('form')">Form</a>
      <a href="gallery.html" class="font-semibold hover:underline" :class="{'underline': page === 'gallery'}" @click.prevent="navigate('gallery')">Gallery</a>
    </div>
    <button
      @click="toggleDarkMode"
      class="p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 transition"
      :aria-label="darkMode ? 'Switch to light mode' : 'Switch to dark mode'"
    >
      <template x-if="darkMode">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M12 3v1m0 16v1m8.485-8.485l-.707.707M4.222 19.778l-.707.707m15.556-15.556l-.707.707M4.222 4.222l-.707.707M21 12h-1M4 12H3" />
        </svg>
      </template>
      <template x-if="!darkMode">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-800" fill="currentColor" viewBox="0 0 20 20" >
          <path d="M10 2a8 8 0 1 0 8 8 7.99 7.99 0 0 1-8-8z" />
        </svg>
      </template>
    </button>
  </nav>

  <!-- Main content container -->
  <main class="flex-grow p-6 max-w-3xl mx-auto w-full" x-show="page === 'form'">

    <h1 class="text-3xl font-bold mb-6">Specialist Request Form</h1>

    <!-- Username input step -->
    <template x-if="step === 'username'">
      <div>
        <label for="username" class="block mb-2 font-medium">Enter your username:</label>
        <input
          id="username"
          type="text"
          x-model="username"
          class="border rounded p-2 w-full mb-4 dark:bg-gray-700 dark:border-gray-600"
          autocomplete="off"
          placeholder="Your Discord username"
        />
        <button
          @click="startForm"
          class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded"
        >Start</button>
      </div>
    </template>

    <!-- Form questions step -->
    <template x-if="step === 'form'">
      <div>
        <p class="mb-4 text-lg font-semibold" x-text="currentQuestion.text"></p>

        <!-- Multiple choice -->
        <template x-if="currentQuestion.type === 'choice'">
          <template x-for="opt in currentQuestion.options" :key="opt.label">
            <button
              @click="selectOption(opt)"
              class="block w-full text-left bg-gray-200 dark:bg-gray-700 hover:bg-green-200 dark:hover:bg-green-600 px-4 py-2 mb-2 rounded"
              x-text="opt.label"
            ></button>
          </template>
        </template>

        <!-- Text input -->
        <template x-if="currentQuestion.type === 'input'">
          <input
            type="text"
            x-model="inputValue"
            @keydown.enter.prevent="submitInput()"
            class="border rounded p-2 w-full mb-4 dark:bg-gray-700 dark:border-gray-600"
            placeholder="Type your answer and press Enter"
            autocomplete="off"
          />
          <button
            :disabled="!inputValue.trim()"
            @click="submitInput"
            class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded disabled:opacity-50"
          >Submit</button>
        </template>
      </div>
    </template>

    <!-- Output step -->
    <template x-if="step === 'output'">
      <div>
        <h2 class="text-2xl font-semibold mb-2">Generated Request Text</h2>
        <textarea
          readonly
          x-text="result"
          class="w-full h-48 p-3 rounded border dark:bg-gray-800 dark:border-gray-700 font-mono whitespace-pre-wrap"
        ></textarea>
        <button
          @click="copyResult"
          class="mt-3 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded"
        >
          Copy to Clipboard
        </button>
        <p
          x-show="copied"
          x-transition
          class="text-green-400 mt-2 font-semibold"
        >Copied!</p>
        <button
          @click="resetForm"
          class="mt-4 text-blue-600 underline"
        >Start Over</button>
      </div>
    </template>

  </main>

  <!-- Placeholder for gallery page content -->
  <main class="flex-grow p-6 max-w-3xl mx-auto w-full" x-show="page === 'gallery'" x-cloak>
    <h1 class="text-3xl font-bold mb-6">Gallery (coming soon!)</h1>
    <p>Gallery page content will be added here.</p>
  </main>

  <script>
    function mainApp() {
      return {
        page: 'form',  // 'form' or 'gallery'
        darkMode: false,

        step: 'username', // username, form, output
        username: '',
        currentQuestionId: null,
        inputValue: '',
        answers: [],
        copied: false,
        questions: {},

        async loadQuestions() {
          try {
            const res = await fetch('risp-questions.json');
            this.questions = await res.json();
          } catch (e) {
            alert('Failed to load risp-questions.json');
            console.error(e);
          }
        },

        get currentQuestion() {
          return this.questions[this.currentQuestionId] || {};
        },

        navigate(target) {
          this.page = target;
          if (target === 'form') {
            this.resetForm();
          }
        },

        toggleDarkMode() {
          this.darkMode = !this.darkMode;
          if (this.darkMode) {
            document.documentElement.classList.add('dark');
            localStorage.setItem('darkMode', 'true');
          } else {
            document.documentElement.classList.remove('dark');
            localStorage.setItem('darkMode', 'false');
          }
        },

        startForm() {
          if (!this.username.trim()) {
            alert('Please enter your username.');
            return;
          }
          this.answers = [];
          this.inputValue = '';
          this.currentQuestionId = 'q1';
          this.step = 'form';
        },

        selectOption(option) {
          this.answers.push({
            question: this.currentQuestion.text,
            options: this.currentQuestion.options || [],
            selected: option.label,
          });

          if (option.next === 'end') {
            this.step = 'output';
          } else {
            this.currentQuestionId = option.next;
            this.inputValue = '';
          }
        },

        submitInput() {
          if (!this.inputValue.trim()) return;
          this.answers.push({
            question: this.currentQuestion.text,
            options: null,
            selected: this.inputValue.trim(),
          });

          if (this.currentQuestion.next === 'end') {
            this.step = 'output';
          } else {
            this.currentQuestionId = this.currentQuestion.next;
            this.inputValue = '';
          }
        },

        get result() {
          let output = '```\n' + this.username + '\n\n';
          this.answers.forEach(a => {
            output += a.question + '\n';
            if (a.options) {
              a.options.forEach(opt => {
                output += (opt.label === a.selected ? '✅' : '⬜') + ' ' + opt.label + '\n';
              });
            } else {
              output += '➡️ ' + a.selected + '\n';
            }
            output += '\n';
          });
          output += '```';
          return output;
        },

        copyResult() {
          navigator.clipboard.writeText(this.result).then(() => {
            this.copied = true;
            setTimeout(() => (this.copied = false), 2000);
          });
        },

        resetForm() {
          this.step = 'username';
          this.username = '';
          this.answers = [];
          this.currentQuestionId = null;
          this.inputValue = '';
        },

        init() {
          // Load dark mode preference
          this.darkMode = localStorage.getItem('darkMode') === 'true';
          if (this.darkMode) document.documentElement.classList.add('dark');
          else document.documentElement.classList.remove('dark');

          // Load questions from external JSON
          this.loadQuestions();
        },
      }
    }
  </script>
</body>
</html>
